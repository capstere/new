diff -ruN /mnt/data/ps5compiled_orig/PS5Compiled/DRIFT_README.txt /mnt/data/ps5compiled_minlog/PS5Compiled/DRIFT_README.txt
--- /mnt/data/ps5compiled_orig/PS5Compiled/DRIFT_README.txt	2026-01-28 10:39:47.000000000 +0000
+++ /mnt/data/ps5compiled_minlog/PS5Compiled/DRIFT_README.txt	2026-01-28 16:27:34.294311023 +0000
@@ -7,3 +7,30 @@
 - använd DEV/QA-paketet med CSV + Build-RuleBank.ps1 för att generera en ny RuleBank.compiled.psd1
 - ersätt sedan RuleBank\RuleBank.compiled.psd1 i denna DRIFT-mapp
 
+---
+
+Prestanda: kör lokalt med launcher (rekommenderat)
+
+Den här mappen innehåller en "Launcher"-mapp med:
+  - Launcher\Main.bat
+  - Launcher\Launcher.ps1
+  - Launcher\SourcePath.txt
+
+Upplägg:
+  1) Lägg Launcher\Main.bat + Launcher\Launcher.ps1 + Launcher\SourcePath.txt i valfri
+     start-mapp på N: (t.ex. "BETA_TEST").
+  2) Skriv EN rad i SourcePath.txt: sökvägen till projektroten (den här mappen som innehåller Main.ps1).
+  3) Kör Main.bat.
+
+Launchern kopierar projektet första gången till C:\IPTCompile\app och kör därifrån.
+Nästa körning körs direkt lokalt (ingen kopiering) så länge Version.txt är oförändrad.
+
+Versionering:
+  - Uppdatera Version.txt i projektroten när ni publicerar en ny version.
+  - Launchern recopy:ar endast när Version.txt ändrats.
+
+Loggar/Audit:
+  - Launchern sätter miljövariabeln IPT_NETWORK_ROOT till projektroten på N:.
+  - Config.ps1 + Logging.ps1 använder IPT_NETWORK_ROOT för Loggar/audit så att loggar hamnar på N:
+    även när verktyget körs från lokal cache.
+
diff -ruN /mnt/data/ps5compiled_orig/PS5Compiled/Launcher/Launcher.ps1 /mnt/data/ps5compiled_minlog/PS5Compiled/Launcher/Launcher.ps1
--- /mnt/data/ps5compiled_orig/PS5Compiled/Launcher/Launcher.ps1	1970-01-01 00:00:00.000000000 +0000
+++ /mnt/data/ps5compiled_minlog/PS5Compiled/Launcher/Launcher.ps1	2026-01-28 16:26:30.645669669 +0000
@@ -0,0 +1,278 @@
+# Launcher.ps1 (Windows PowerShell 5.1)
+# Cache-first runner for IPTCompile
+#
+# Behavior:
+# 1) First run: copy project from network to C:\IPTCompile\app then run locally
+# 2) Subsequent runs: run locally directly; only recopy if Version.txt changed
+#
+# The launcher sets IPT_NETWORK_ROOT to the network project root so logs/audits
+# end up on N: even when the tool runs from local cache.
+
+Set-StrictMode -Version 2.0
+$ErrorActionPreference = 'Stop'
+
+# ----------------------------- Settings -----------------------------
+$AppName            = 'IPTCompile'
+$PreferredBase      = 'C:\IPTCompile'
+$CacheAppFolderName = 'app'
+$AuditFolderName    = '_LauncherAudit'
+$VersionFileName    = 'Version.txt'
+$SourcePathFileName = 'SourcePath.txt'
+
+# Robocopy tuning (safe defaults for SMB shares)
+$RoboCopyMT   = 8
+$RoboRetries  = 2
+$RoboWaitSec  = 1
+
+# Exclude folders that should stay on the network only (avoid churn and oversized cache)
+$ExcludeDirs = @($AuditFolderName, 'Loggar', 'audit')
+
+# ----------------------------- Helpers -----------------------------
+function Get-ScriptDir {
+    $p = $MyInvocation.MyCommand.Path
+    if (-not $p) { return (Get-Location).Path }
+    return (Split-Path -LiteralPath $p -Parent)
+}
+
+function Read-FirstNonEmptyLine([string]$Path) {
+    if (-not (Test-Path -LiteralPath $Path)) { return $null }
+    foreach ($line in [System.IO.File]::ReadAllLines($Path)) {
+        $t = ($line + '').Trim()
+        if ($t) {
+            # Strip optional surrounding quotes
+            if ($t.StartsWith('"') -and $t.EndsWith('"') -and $t.Length -ge 2) {
+                $t = $t.Substring(1, $t.Length - 2)
+            }
+            return $t.Trim()
+        }
+    }
+    return $null
+}
+
+function Ensure-DirWritable([string]$Path) {
+    try {
+        if (-not (Test-Path -LiteralPath $Path)) {
+            New-Item -Path $Path -ItemType Directory -Force | Out-Null
+        }
+        $probe = Join-Path $Path ("._probe_{0}.tmp" -f [Guid]::NewGuid().ToString('N'))
+        [System.IO.File]::WriteAllText($probe, 'ok')
+        Remove-Item -LiteralPath $probe -Force -ErrorAction SilentlyContinue
+        return $true
+    } catch {
+        return $false
+    }
+}
+
+function Normalize-Version([string]$v) {
+    $t = ($v + '').Trim()
+    if (-not $t) { return '0' }
+    return $t
+}
+
+function Write-Audit {
+    param(
+        [string]$AuditDir,
+        [string]$Message,
+        [ValidateSet('INFO','WARN','ERROR')] [string]$Level = 'INFO'
+    )
+    $ts = (Get-Date).ToString('yyyy-MM-dd HH:mm:ss')
+    $line = '[{0}] [{1}] {2}' -f $ts, $Level, $Message
+
+    Write-Host $line
+    if (-not $AuditDir) { return }
+
+    try {
+        if (-not (Test-Path -LiteralPath $AuditDir)) {
+            New-Item -Path $AuditDir -ItemType Directory -Force | Out-Null
+        }
+        $logPath = Join-Path $AuditDir 'Launcher.log'
+        Add-Content -LiteralPath $logPath -Value $line -Encoding UTF8
+    } catch {
+        # best-effort
+    }
+}
+
+function Invoke-Robocopy {
+    param(
+        [string]$Source,
+        [string]$Dest,
+        [string[]]$ExcludeDirectories,
+        [string]$LogFile
+    )
+
+    $args = New-Object System.Collections.Generic.List[string]
+    $args.Add("`"$Source`"")
+    $args.Add("`"$Dest`"")
+    $args.Add('/MIR')
+    $args.Add("/R:$RoboRetries")
+    $args.Add("/W:$RoboWaitSec")
+    $args.Add('/FFT')
+    $args.Add('/XJ')
+    $args.Add('/NP')
+    $args.Add('/NFL')
+    $args.Add('/NDL')
+    $args.Add('/NJH')
+    $args.Add('/NJS')
+    $args.Add("/MT:$RoboCopyMT")
+
+    foreach ($xd in ($ExcludeDirectories | Where-Object { $_ })) {
+        # /XD can take full paths; use full path for safety
+        $args.Add('/XD')
+        $args.Add("`"$([System.IO.Path]::Combine($Source, $xd))`"")
+    }
+
+    if ($LogFile) {
+        $args.Add('/LOG:')
+        $args.Add("`"$LogFile`"")
+    }
+
+    $p = Start-Process -FilePath 'robocopy.exe' -ArgumentList $args.ToArray() -Wait -PassThru -WindowStyle Hidden
+    return $p.ExitCode
+}
+
+function Safe-DeleteDir([string]$Path) {
+    try {
+        if (Test-Path -LiteralPath $Path) {
+            Remove-Item -LiteralPath $Path -Recurse -Force -ErrorAction Stop
+        }
+    } catch {
+        # best-effort
+    }
+}
+
+function Run-Main([string]$MainPath) {
+    if ($script:SourceRoot) { $env:IPT_NETWORK_ROOT = $script:SourceRoot }
+    & powershell.exe -NoProfile -ExecutionPolicy Bypass -File $MainPath
+    exit $LASTEXITCODE
+}
+
+# ----------------------------- Main -----------------------------
+$scriptDir = Get-ScriptDir
+$srcFile   = Join-Path $scriptDir $SourcePathFileName
+$script:SourceRoot = Read-FirstNonEmptyLine -Path $srcFile
+
+if (-not $script:SourceRoot) {
+    Write-Host '[ERROR] Missing or empty SourcePath.txt next to Launcher.ps1'
+    exit 1
+}
+
+$script:SourceRoot = $script:SourceRoot.TrimEnd('\')
+$mainNet = Join-Path $script:SourceRoot 'Main.ps1'
+if (-not (Test-Path -LiteralPath $mainNet)) {
+    Write-Host ('[ERROR] SourcePath does not contain Main.ps1: {0}' -f $script:SourceRoot)
+    exit 1
+}
+
+$auditDir = Join-Path $script:SourceRoot $AuditFolderName
+Write-Audit -AuditDir $auditDir -Level INFO -Message ('Launcher start. SourceRoot={0}' -f $script:SourceRoot)
+
+if (-not (Ensure-DirWritable -Path $PreferredBase)) {
+    Write-Audit -AuditDir $auditDir -Level ERROR -Message ('Could not create writable cache folder: {0}. Running from network.' -f $PreferredBase)
+    Run-Main -MainPath $mainNet
+}
+
+$dest  = Join-Path $PreferredBase $CacheAppFolderName
+$old   = Join-Path $PreferredBase 'app_old'
+$stage = Join-Path $PreferredBase '_staging'
+$rbLog = Join-Path $PreferredBase 'robocopy_last.log'
+
+# Guard against rundgång
+try {
+    $srcFull  = [System.IO.Path]::GetFullPath($script:SourceRoot)
+    $destFull = [System.IO.Path]::GetFullPath($dest)
+    if ($destFull.StartsWith($srcFull, [System.StringComparison]::OrdinalIgnoreCase) -or
+        $srcFull.StartsWith($destFull, [System.StringComparison]::OrdinalIgnoreCase)) {
+        throw ('Safety check failed: Source and cache paths overlap. Source={0} Cache={1}' -f $srcFull, $destFull)
+    }
+} catch {
+    Write-Audit -AuditDir $auditDir -Level ERROR -Message $_.Exception.Message
+    Run-Main -MainPath $mainNet
+}
+
+# Versions
+$netVerPath = Join-Path $script:SourceRoot $VersionFileName
+$locVerPath = Join-Path $dest $VersionFileName
+
+$vNet = Normalize-Version (Read-FirstNonEmptyLine -Path $netVerPath)
+$vLoc = Normalize-Version (Read-FirstNonEmptyLine -Path $locVerPath)
+
+$needCopy = $false
+if (-not (Test-Path -LiteralPath (Join-Path $dest 'Main.ps1'))) { $needCopy = $true }
+elseif (Test-Path -LiteralPath $netVerPath) {
+    if ($vNet -ne $vLoc) { $needCopy = $true }
+}
+
+$mutexName = ('Global\{0}_CacheUpdate' -f $AppName)
+$mutex = New-Object System.Threading.Mutex($false, $mutexName)
+$haveMutex = $false
+
+try {
+    $haveMutex = $mutex.WaitOne(25000)
+    if (-not $haveMutex) {
+        Write-Audit -AuditDir $auditDir -Level WARN -Message 'Cache update lock busy. Will run existing cache if present.'
+        $needCopy = $false
+    }
+
+    if ($needCopy) {
+        Write-Audit -AuditDir $auditDir -Level INFO -Message ('Updating cache. Dest={0} vNet={1} vLoc={2}' -f $dest, $vNet, $vLoc)
+
+        Safe-DeleteDir -Path $stage
+        New-Item -Path $stage -ItemType Directory -Force | Out-Null
+
+        $rc = Invoke-Robocopy -Source $script:SourceRoot -Dest $stage -ExcludeDirectories $ExcludeDirs -LogFile $rbLog
+        Write-Audit -AuditDir $auditDir -Level INFO -Message ('Robocopy exit code={0} (0-7 OK, 8+ error). Log={1}' -f $rc, $rbLog)
+
+        if ($rc -ge 8) {
+            Write-Audit -AuditDir $auditDir -Level ERROR -Message 'Robocopy failed. Running from network fallback.'
+            Safe-DeleteDir -Path $stage
+            Run-Main -MainPath $mainNet
+        }
+
+        # Swap with rollback
+        Safe-DeleteDir -Path $old
+        if (Test-Path -LiteralPath $dest) {
+            try {
+                Rename-Item -LiteralPath $dest -NewName (Split-Path -Leaf $old) -ErrorAction Stop
+            } catch {
+                Safe-DeleteDir -Path $dest
+            }
+        }
+
+        try {
+            Rename-Item -LiteralPath $stage -NewName (Split-Path -Leaf $dest) -ErrorAction Stop
+        } catch {
+            Write-Audit -AuditDir $auditDir -Level ERROR -Message ('Cache swap failed: {0}. Running from network.' -f $_.Exception.Message)
+            Safe-DeleteDir -Path $dest
+            if (Test-Path -LiteralPath $old) {
+                try { Rename-Item -LiteralPath $old -NewName (Split-Path -Leaf $dest) -ErrorAction SilentlyContinue } catch { }
+            }
+            Run-Main -MainPath $mainNet
+        }
+
+        $mainLocal = Join-Path $dest 'Main.ps1'
+        if (-not (Test-Path -LiteralPath $mainLocal)) {
+            Write-Audit -AuditDir $auditDir -Level ERROR -Message 'Cache missing Main.ps1 after swap. Rolling back + running from network.'
+            Safe-DeleteDir -Path $dest
+            if (Test-Path -LiteralPath $old) {
+                try { Rename-Item -LiteralPath $old -NewName (Split-Path -Leaf $dest) -ErrorAction SilentlyContinue } catch { }
+            }
+            Run-Main -MainPath $mainNet
+        }
+
+        if (Test-Path -LiteralPath $netVerPath) {
+            try { Set-Content -LiteralPath (Join-Path $dest $VersionFileName) -Value $vNet -Encoding ASCII } catch { }
+        }
+
+        Safe-DeleteDir -Path $old
+    } else {
+        Write-Audit -AuditDir $auditDir -Level INFO -Message ('Cache up-to-date. vLoc={0}' -f $vLoc)
+    }
+
+} finally {
+    if ($haveMutex) { try { $mutex.ReleaseMutex() } catch { } }
+    $mutex.Dispose()
+}
+
+$mainLocalFinal = Join-Path $dest 'Main.ps1'
+Write-Audit -AuditDir $auditDir -Level INFO -Message ('Running locally: {0}' -f $mainLocalFinal)
+Run-Main -MainPath $mainLocalFinal
diff -ruN /mnt/data/ps5compiled_orig/PS5Compiled/Launcher/Main.bat /mnt/data/ps5compiled_minlog/PS5Compiled/Launcher/Main.bat
--- /mnt/data/ps5compiled_orig/PS5Compiled/Launcher/Main.bat	1970-01-01 00:00:00.000000000 +0000
+++ /mnt/data/ps5compiled_minlog/PS5Compiled/Launcher/Main.bat	2026-01-28 16:10:08.250212907 +0000
@@ -0,0 +1,10 @@
+@echo off
+setlocal EnableExtensions
+REM ------------------------------------------------------------
+REM IPTCompile Launcher
+REM - Uses Launcher.ps1 next to this BAT
+REM - SourcePath.txt must be next to this BAT/PS1
+REM ------------------------------------------------------------
+
+powershell.exe -NoProfile -ExecutionPolicy Bypass -File "%~dp0Launcher.ps1"
+exit /b %ERRORLEVEL%
diff -ruN /mnt/data/ps5compiled_orig/PS5Compiled/Launcher/SourcePath.txt /mnt/data/ps5compiled_minlog/PS5Compiled/Launcher/SourcePath.txt
--- /mnt/data/ps5compiled_orig/PS5Compiled/Launcher/SourcePath.txt	1970-01-01 00:00:00.000000000 +0000
+++ /mnt/data/ps5compiled_minlog/PS5Compiled/Launcher/SourcePath.txt	2026-01-28 16:10:21.936422622 +0000
@@ -0,0 +1 @@
+\\REPLACE_ME\path\to\IPTCompile
diff -ruN /mnt/data/ps5compiled_orig/PS5Compiled/Modules/Config.ps1 /mnt/data/ps5compiled_minlog/PS5Compiled/Modules/Config.ps1
--- /mnt/data/ps5compiled_orig/PS5Compiled/Modules/Config.ps1	2026-01-28 12:49:49.000000000 +0000
+++ /mnt/data/ps5compiled_minlog/PS5Compiled/Modules/Config.ps1	2026-01-28 16:07:09.209524622 +0000
@@ -1,186 +1,191 @@
-﻿param(
-    [string]$ScriptRoot = (Split-Path -Parent $MyInvocation.MyCommand.Path)
-)
-
-# --- Patch: Centraliserad IPT-root (ENV override) ---
-$script:ScriptRoot = $ScriptRoot
-$script:DefaultIptRoot = 'N:\QC\QC-1\IPT'
-$script:IPTRoot = if ($env:IPT_ROOT -and $env:IPT_ROOT.Trim().Length -gt 0) {
-    $candidate = $env:IPT_ROOT.Trim().TrimEnd('\')
-    if (Test-Path -LiteralPath $candidate) { $candidate } else { $script:DefaultIptRoot }
-} else {
-    $script:DefaultIptRoot
-}
-
-# Exponera för debug/loggning
-$global:IPT_ROOT_EFFECTIVE = $script:IPTRoot
-$global:IPT_ROOT_SOURCE = if ($env:IPT_ROOT -and $env:IPT_ROOT.Trim().Length -gt 0) {
-    $candidate = $env:IPT_ROOT.Trim().TrimEnd('\')
-    if (Test-Path -LiteralPath $candidate) { 'ENV' } else { 'ENV_INVALID_FALLBACK' }
-} else { 'DEFAULT' }
-
-function Resolve-IptPath {
-    param([string]$Path)
-    if ([string]::IsNullOrWhiteSpace($Path)) { return $Path }
-    if ($Path -like "$($script:DefaultIptRoot)\*") {
-        return ($script:IPTRoot + $Path.Substring($script:DefaultIptRoot.Length))
-    }
-    return $Path
-}
-# -------------------------------------------------
-
-# === Inställningar ===
-$ScriptVersion = "v45.1.0"
-
-$RootPaths = @(
-    'N:\QC\QC-1\IPT\Skiftspecifika dokument\PQC analyst\JESPER\Scripts\Tests',
-    'N:\QC\QC-1\IPT\3. IPT - KLART FÖR SAMMANSTÄLLNING',
-    'N:\QC\QC-1\IPT\4. IPT - KLART FÖR GRANSKNING'
-)
-
-$RootPaths = $RootPaths | ForEach-Object { Resolve-IptPath $_ }
-
-$ikonSokvag = Join-Path $ScriptRoot "icon.png"
-$UtrustningListPath = "N:\QC\QC-1\IPT\Skiftspecifika dokument\PQC analyst\JESPER\Scripts\Click Less Project\Utrustninglista5.0.xlsx"
-$RawDataPath        = "N:\QC\QC-1\IPT\KONTROLLPROVSFIL - Version 2.5.xlsm"
-
-$OtherScriptPath = ''
-
-$Script1Path  = 'N:\QC\QC-1\IPT\Skiftspecifika dokument\PQC analyst\JESPER\Kontrollprovsfil 2025\Script Raw Data\Kontrollprovsfil_EPPlus_2025.ps1'
-$Script2Path  = 'N:\QC\QC-1\IPT\Skiftspecifika dokument\PQC analyst\JESPER\Scripts\Click Less Project\rename-GUI.bat'
-$Script3Path  = 'N:\QC\QC-1\IPT\Skiftspecifika dokument\PQC analyst\JESPER\Scripts\Click Less Project\rename-GUI.bat'
-
-$env:PNPPOWERSHELL_UPDATECHECK = "Off"
-$global:SP_ClientId   = "23715695-a9a6-4f32-af7b-4cd164e0f1f9"
-$global:SP_Tenant     = "danaher.onmicrosoft.com"
-$global:SP_CertBase64 = "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"
-$global:SP_SiteUrl    = "https://danaher.sharepoint.com/sites/CEP-Sweden-Production-Management"
-
-# === Centraliserad konfiguration ===
-$Config = [ordered]@{
-
-    # === Feature flags (safe defaults) ===
-    EnableEquipmentSheet = $false   # Performance: completely skip Equipment (Infinity/GX) sheet and WS equipment extraction
-    EnableEquipmentScan  = $false   # Kept for compatibility; ignored when EnableEquipmentSheet is $false
-    EnableRuleEngine    = $true       # New RuleEngine (shadow-mode)
-    EnableShadowCompare = $true        # Log diff between legacy and rules when EnableRuleEngine is on
-    # When true: writes RuleEngine summary lines to GUI-log (counts/dev/retest).
-    # Set to $false for a quieter GUI-log while still writing RuleEngine_Debug.
-    EnableRuleEngineSummaryLog = $false
-    EnableRuleEngineDebugSheet = $true        # Add RuleEngine_Debug worksheet to output (safe, appended)
-    RuleEngineDebugIncludeAllRows = $false # When true: write ALL rows in RuleEngine_Debug (legacy behavior)
-
-    # EPPlus AutoFit strategy (performance)
-    # OFF   = no AutoFit (fastest)
-    # ON    = always AutoFit
-    # SMART = AutoFit only for "small" written ranges (prevents large-file slowdowns)
-    EpplusAutoFitMode = 'SMART'
-    EpplusAutoFitMaxRows = 500
-    RuleBankDir         = (Join-Path $ScriptRoot 'RuleBank')
-    # If true: require RuleBank.compiled.psd1 and do NOT fall back to CSV.
-    # This avoids CSV I/O (important for N:/UNC). Build via RuleBank\build\Build-RuleBank.ps1.
-    RuleBankRequireCompiled = $true
-    CsvStreamingThresholdMB = 25   # Byt till t.ex. 10 om du vill streama tidigare
-    CsvPath       = ''           # Sökväg till CSV-fil
-    SealNegPath   = ''           # Sökväg till Seal Test NEG
-    SealPosPath   = ''           # Sökväg till Seal Test POS
-    WorksheetPath = ''           # Sökväg till LSP worksheet (Worksheet.xlsx)
-    SiteUrl      = $global:SP_SiteUrl
-    Tenant       = $global:SP_Tenant
-    ClientId     = $global:SP_ClientId
-    Certificate  = $global:SP_CertBase64
-    EpplusDllPath = (Join-Path $ScriptRoot 'Modules\EPPlus.dll')
-    EpplusVersion = '4.5.3.3'
-    AllowNuGetDownload = $false
-}
-
-# Exponera konfig globalt (används av vissa moduler, t.ex. RuleEngine Load-RuleBank)
-# Bakåtkompatibelt: $Config finns kvar i script-scope.
-try { $global:Config = $Config } catch {}
-
-$script:GXINF_Map = @{
-    'Infinity-VI'   = '847922'
-    'Infinity-VIII' = '803094'
-    'GX5'           = '750210,750211,750212,750213'
-    'GX6'           = '750246,750247,750248,750249'
-    'GX1'           = '709863,709864,709865,709866'
-    'GX2'           = '709951,709952,709953,709954'
-    'GX3'           = '710084,710085,710086,710087'
-    'GX7'           = '750170,750171,750172,750213'
-    'Infinity-I'    = '802069'
-    'Infinity-III'  = '807363'
-    'Infinity-V'    = '839032'
-}
-
-$SharePointBatchLinkTemplate = 'https://danaher.sharepoint.com/sites/CEP-Sweden-Production-Management/Lists/Cepheid%20%20Production%20orders/ROBAL.aspx?viewid=6c9e53c9-a377-40c1-a154-13a13866b52b&view=7&q={BatchNumber}'
-
-$DevLogDir = Join-Path $ScriptRoot 'Loggar'
-if (-not (Test-Path $DevLogDir)) { New-Item -ItemType Directory -Path $DevLogDir -Force | Out-Null }
-$global:LogPath = Join-Path $DevLogDir ("$($env:USERNAME)_$(Get-Date -Format 'yyyyMMdd_HHmmss').txt")
-$global:StructuredLogPath = [System.IO.Path]::ChangeExtension($global:LogPath, '.jsonl')
-
-function Test-Config {
-    $result = [pscustomobject]@{
-        Ok       = $true
-        Errors   = New-Object System.Collections.Generic.List[object]
-        Warnings = New-Object System.Collections.Generic.List[object]
-    }
-
-    try {
-        $templatePath = Join-Path $ScriptRoot 'output_template-v4.xlsx'
-        if (-not (Test-Path -LiteralPath $templatePath)) {
-            $null = $result.Errors.Add("Mallfil saknas: $templatePath")
-        }
-    } catch {
-        $null = $result.Errors.Add("Test-Config (template): $($_.Exception.Message)")
-    }
-    try {
-        if (-not (Test-Path -LiteralPath $UtrustningListPath)) {
-            $null = $result.Warnings.Add("Utrustningslista saknas: $UtrustningListPath")
-        }
-    } catch {
-        $null = $result.Warnings.Add("Test-Config (utrustning): $($_.Exception.Message)")
-    }
-
-    try {
-
-        if (-not (Test-Path -LiteralPath $RawDataPath)) {
-            $null = $result.Warnings.Add("Kontrollprovsfil saknas: $RawDataPath")
-        }
-    } catch {
-        $null = $result.Warnings.Add("Test-Config (rawdata): $($_.Exception.Message)")
-    } 
-try {
-        if (-not (Test-Path -LiteralPath $DevLogDir)) {
-            New-Item -ItemType Directory -Path $DevLogDir -Force | Out-Null
-        }
-        $probe = Join-Path $DevLogDir "write_probe.txt"
-        Set-Content -Path $probe -Value 'probe' -Encoding UTF8 -Force
-        Remove-Item -LiteralPath $probe -Force -ErrorAction SilentlyContinue
-    } catch {
-        $null = $result.Warnings.Add("Kunde inte verifiera skrivning till loggmapp: $($_.Exception.Message)")
-    }
-    if ($result.Errors.Count -gt 0) { $result.Ok = $false }
-    return $result
-
-}
-
-# Patch: ENV root override för ikonSokvag
-$ikonSokvag = Resolve-IptPath $ikonSokvag
-
-# Patch: ENV root override för UtrustningListPath
-$UtrustningListPath = Resolve-IptPath $UtrustningListPath
-
-# Patch: ENV root override för RawDataPath
-$RawDataPath = Resolve-IptPath $RawDataPath
-# Patch: ENV root override för OtherScriptPath
-$OtherScriptPath = Resolve-IptPath $OtherScriptPath
-
-# Patch: ENV root override för Script1Path
-$Script1Path = Resolve-IptPath $Script1Path
-
-# Patch: ENV root override för Script2Path
-$Script2Path = Resolve-IptPath $Script2Path
-
-# Patch: ENV root override för Script3Path
-$Script3Path = Resolve-IptPath $Script3Path
+﻿param(
+    [string]$ScriptRoot = (Split-Path -Parent $MyInvocation.MyCommand.Path)
+)
+
+# --- Patch: Centraliserad IPT-root (ENV override) ---
+$script:ScriptRoot = $ScriptRoot
+$script:DefaultIptRoot = 'N:\QC\QC-1\IPT'
+$script:IPTRoot = if ($env:IPT_ROOT -and $env:IPT_ROOT.Trim().Length -gt 0) {
+    $candidate = $env:IPT_ROOT.Trim().TrimEnd('\')
+    if (Test-Path -LiteralPath $candidate) { $candidate } else { $script:DefaultIptRoot }
+} else {
+    $script:DefaultIptRoot
+}
+
+# Exponera för debug/loggning
+$global:IPT_ROOT_EFFECTIVE = $script:IPTRoot
+$global:IPT_ROOT_SOURCE = if ($env:IPT_ROOT -and $env:IPT_ROOT.Trim().Length -gt 0) {
+    $candidate = $env:IPT_ROOT.Trim().TrimEnd('\')
+    if (Test-Path -LiteralPath $candidate) { 'ENV' } else { 'ENV_INVALID_FALLBACK' }
+} else { 'DEFAULT' }
+
+function Resolve-IptPath {
+    param([string]$Path)
+    if ([string]::IsNullOrWhiteSpace($Path)) { return $Path }
+    if ($Path -like "$($script:DefaultIptRoot)\*") {
+        return ($script:IPTRoot + $Path.Substring($script:DefaultIptRoot.Length))
+    }
+    return $Path
+}
+# -------------------------------------------------
+
+# === Inställningar ===
+$ScriptVersion = "v45.1.0"
+
+$RootPaths = @(
+    'N:\QC\QC-1\IPT\Skiftspecifika dokument\PQC analyst\JESPER\Scripts\Tests',
+    'N:\QC\QC-1\IPT\3. IPT - KLART FÖR SAMMANSTÄLLNING',
+    'N:\QC\QC-1\IPT\4. IPT - KLART FÖR GRANSKNING'
+)
+
+$RootPaths = $RootPaths | ForEach-Object { Resolve-IptPath $_ }
+
+$ikonSokvag = Join-Path $ScriptRoot "icon.png"
+$UtrustningListPath = "N:\QC\QC-1\IPT\Skiftspecifika dokument\PQC analyst\JESPER\Scripts\Click Less Project\Utrustninglista5.0.xlsx"
+$RawDataPath        = "N:\QC\QC-1\IPT\KONTROLLPROVSFIL - Version 2.5.xlsm"
+
+$OtherScriptPath = ''
+
+$Script1Path  = 'N:\QC\QC-1\IPT\Skiftspecifika dokument\PQC analyst\JESPER\Kontrollprovsfil 2025\Script Raw Data\Kontrollprovsfil_EPPlus_2025.ps1'
+$Script2Path  = 'N:\QC\QC-1\IPT\Skiftspecifika dokument\PQC analyst\JESPER\Scripts\Click Less Project\rename-GUI.bat'
+$Script3Path  = 'N:\QC\QC-1\IPT\Skiftspecifika dokument\PQC analyst\JESPER\Scripts\Click Less Project\rename-GUI.bat'
+
+$env:PNPPOWERSHELL_UPDATECHECK = "Off"
+$global:SP_ClientId   = "23715695-a9a6-4f32-af7b-4cd164e0f1f9"
+$global:SP_Tenant     = "danaher.onmicrosoft.com"
+$global:SP_CertBase64 = "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"
+$global:SP_SiteUrl    = "https://danaher.sharepoint.com/sites/CEP-Sweden-Production-Management"
+
+# === Centraliserad konfiguration ===
+$Config = [ordered]@{
+
+    # === Feature flags (safe defaults) ===
+    EnableEquipmentSheet = $false   # Performance: completely skip Equipment (Infinity/GX) sheet and WS equipment extraction
+    EnableEquipmentScan  = $false   # Kept for compatibility; ignored when EnableEquipmentSheet is $false
+    EnableRuleEngine    = $true       # New RuleEngine (shadow-mode)
+    EnableShadowCompare = $true        # Log diff between legacy and rules when EnableRuleEngine is on
+    # When true: writes RuleEngine summary lines to GUI-log (counts/dev/retest).
+    # Set to $false for a quieter GUI-log while still writing RuleEngine_Debug.
+    EnableRuleEngineSummaryLog = $false
+    EnableRuleEngineDebugSheet = $true        # Add RuleEngine_Debug worksheet to output (safe, appended)
+    RuleEngineDebugIncludeAllRows = $false # When true: write ALL rows in RuleEngine_Debug (legacy behavior)
+
+    # EPPlus AutoFit strategy (performance)
+    # OFF   = no AutoFit (fastest)
+    # ON    = always AutoFit
+    # SMART = AutoFit only for "small" written ranges (prevents large-file slowdowns)
+    EpplusAutoFitMode = 'SMART'
+    EpplusAutoFitMaxRows = 500
+    RuleBankDir         = (Join-Path $ScriptRoot 'RuleBank')
+    # If true: require RuleBank.compiled.psd1 and do NOT fall back to CSV.
+    # This avoids CSV I/O (important for N:/UNC). Build via RuleBank\build\Build-RuleBank.ps1.
+    RuleBankRequireCompiled = $true
+    CsvStreamingThresholdMB = 25   # Byt till t.ex. 10 om du vill streama tidigare
+    CsvPath       = ''           # Sökväg till CSV-fil
+    SealNegPath   = ''           # Sökväg till Seal Test NEG
+    SealPosPath   = ''           # Sökväg till Seal Test POS
+    WorksheetPath = ''           # Sökväg till LSP worksheet (Worksheet.xlsx)
+    SiteUrl      = $global:SP_SiteUrl
+    Tenant       = $global:SP_Tenant
+    ClientId     = $global:SP_ClientId
+    Certificate  = $global:SP_CertBase64
+    EpplusDllPath = (Join-Path $ScriptRoot 'Modules\EPPlus.dll')
+    EpplusVersion = '4.5.3.3'
+    AllowNuGetDownload = $false
+}
+
+# Exponera konfig globalt (används av vissa moduler, t.ex. RuleEngine Load-RuleBank)
+# Bakåtkompatibelt: $Config finns kvar i script-scope.
+try { $global:Config = $Config } catch {}
+
+$script:GXINF_Map = @{
+    'Infinity-VI'   = '847922'
+    'Infinity-VIII' = '803094'
+    'GX5'           = '750210,750211,750212,750213'
+    'GX6'           = '750246,750247,750248,750249'
+    'GX1'           = '709863,709864,709865,709866'
+    'GX2'           = '709951,709952,709953,709954'
+    'GX3'           = '710084,710085,710086,710087'
+    'GX7'           = '750170,750171,750172,750213'
+    'Infinity-I'    = '802069'
+    'Infinity-III'  = '807363'
+    'Infinity-V'    = '839032'
+}
+
+$SharePointBatchLinkTemplate = 'https://danaher.sharepoint.com/sites/CEP-Sweden-Production-Management/Lists/Cepheid%20%20Production%20orders/ROBAL.aspx?viewid=6c9e53c9-a377-40c1-a154-13a13866b52b&view=7&q={BatchNumber}'
+
+$netRootForLogs = ($env:IPT_NETWORK_ROOT + '').Trim()
+if ($netRootForLogs -and (Test-Path -LiteralPath $netRootForLogs)) {
+    $DevLogDir = Join-Path $netRootForLogs 'Loggar'
+} else {
+    $DevLogDir = Join-Path $ScriptRoot 'Loggar'
+}
+if (-not (Test-Path -LiteralPath $DevLogDir)) { New-Item -ItemType Directory -Path $DevLogDir -Force | Out-Null }
+$global:LogPath = Join-Path $DevLogDir ("$($env:USERNAME)_$(Get-Date -Format 'yyyyMMdd_HHmmss').txt")
+$global:StructuredLogPath = [System.IO.Path]::ChangeExtension($global:LogPath, '.jsonl')
+
+function Test-Config {
+    $result = [pscustomobject]@{
+        Ok       = $true
+        Errors   = New-Object System.Collections.Generic.List[object]
+        Warnings = New-Object System.Collections.Generic.List[object]
+    }
+
+    try {
+        $templatePath = Join-Path $ScriptRoot 'output_template-v4.xlsx'
+        if (-not (Test-Path -LiteralPath $templatePath)) {
+            $null = $result.Errors.Add("Mallfil saknas: $templatePath")
+        }
+    } catch {
+        $null = $result.Errors.Add("Test-Config (template): $($_.Exception.Message)")
+    }
+    try {
+        if (-not (Test-Path -LiteralPath $UtrustningListPath)) {
+            $null = $result.Warnings.Add("Utrustningslista saknas: $UtrustningListPath")
+        }
+    } catch {
+        $null = $result.Warnings.Add("Test-Config (utrustning): $($_.Exception.Message)")
+    }
+
+    try {
+
+        if (-not (Test-Path -LiteralPath $RawDataPath)) {
+            $null = $result.Warnings.Add("Kontrollprovsfil saknas: $RawDataPath")
+        }
+    } catch {
+        $null = $result.Warnings.Add("Test-Config (rawdata): $($_.Exception.Message)")
+    } 
+try {
+        if (-not (Test-Path -LiteralPath $DevLogDir)) {
+            New-Item -ItemType Directory -Path $DevLogDir -Force | Out-Null
+        }
+        $probe = Join-Path $DevLogDir "write_probe.txt"
+        Set-Content -Path $probe -Value 'probe' -Encoding UTF8 -Force
+        Remove-Item -LiteralPath $probe -Force -ErrorAction SilentlyContinue
+    } catch {
+        $null = $result.Warnings.Add("Kunde inte verifiera skrivning till loggmapp: $($_.Exception.Message)")
+    }
+    if ($result.Errors.Count -gt 0) { $result.Ok = $false }
+    return $result
+
+}
+
+# Patch: ENV root override för ikonSokvag
+$ikonSokvag = Resolve-IptPath $ikonSokvag
+
+# Patch: ENV root override för UtrustningListPath
+$UtrustningListPath = Resolve-IptPath $UtrustningListPath
+
+# Patch: ENV root override för RawDataPath
+$RawDataPath = Resolve-IptPath $RawDataPath
+# Patch: ENV root override för OtherScriptPath
+$OtherScriptPath = Resolve-IptPath $OtherScriptPath
+
+# Patch: ENV root override för Script1Path
+$Script1Path = Resolve-IptPath $Script1Path
+
+# Patch: ENV root override för Script2Path
+$Script2Path = Resolve-IptPath $Script2Path
+
+# Patch: ENV root override för Script3Path
+$Script3Path = Resolve-IptPath $Script3Path
diff -ruN /mnt/data/ps5compiled_orig/PS5Compiled/Modules/Logging.ps1 /mnt/data/ps5compiled_minlog/PS5Compiled/Modules/Logging.ps1
--- /mnt/data/ps5compiled_orig/PS5Compiled/Modules/Logging.ps1	2026-01-28 10:39:47.000000000 +0000
+++ /mnt/data/ps5compiled_minlog/PS5Compiled/Modules/Logging.ps1	2026-01-28 16:07:38.142967737 +0000
@@ -1,150 +1,156 @@
-﻿function Get-OutputBox {
-    try { return $script:outputBox } catch { return $null }
-}
-
-function Set-LogOutputControl {
-    param([System.Windows.Forms.TextBox]$Control)
-    $script:outputBox = $Control
-}
-
-function Gui-Log {
-    param(
-        [string]$Text,
-        [ValidateSet('Info', 'Warn', 'Error')]
-        [string]$Severity = 'Info',
-        [string]$Category = 'UI',
-        [hashtable]$Data,
-        [switch]$Immediate
-    )
-
-    # --- Förbered loggrad ---
-    $prefix = switch ($Severity) {
-        'Warn'  { '⚠️' }
-        'Error' { '❌' }
-        default { 'ℹ️' }
-    }
-
-    $timestamp = (Get-Date).ToString('HH:mm:ss')
-    $line = "[$timestamp] $prefix $Text"
-
-    # --- UI‑append scriptblock ---
-    $append = {
-        $outputBox.AppendText("$line`r`n")
-        $outputBox.SelectionStart = $outputBox.TextLength
-        $outputBox.ScrollToCaret()
-        $outputBox.Refresh()
-    }
-
-    # --- Hämta OutputBox ---
-    $outputBox = Get-OutputBox
-
-    if ($outputBox -and ($outputBox.IsDisposed -or -not $outputBox.IsHandleCreated)) {
-        $outputBox = $null
-    }
-
-    if ($outputBox) {
-        try {
-            if ($outputBox.InvokeRequired) {
-                $null = $outputBox.BeginInvoke(
-                    [System.Windows.Forms.MethodInvoker]$append
-                )
-            } else {
-                & $append
-            }
-
-            if ($Immediate) {
-                [System.Windows.Forms.Application]::DoEvents()
-            }
-        }
-        catch {
-            Write-Host $line
-        }
-    }
-    else {
-        Write-Host $line
-    }
-
-    # --- Patch: strukturerad logg (JSONL) ---
-    try {
-        Write-StructuredLog `
-            -Message  $Text `
-            -Severity $Severity `
-            -Category $Category `
-            -Data     $Data
-    } catch {}
-
-    # --- Klassisk filbaserad logg ---
-    if ($global:LogPath) {
-        try {
-            Add-Content -Path $global:LogPath -Value $line -Encoding UTF8
-        }
-        catch {
-            Write-Host "Loggning misslyckades: $($_.Exception.Message)"
-        }
-    }
-}
-
-function Add-AuditEntry {
-    param(
-        [string]$Lsp,
-        [string]$Assay,
-        [string]$BatchNumber,
-        [int]$TestCount,
-        [string]$Status,
-        [string]$ReportPath,
-        [string]$AuditDir
-
-    )
-    try {
-        if (-not $AuditDir) {
-            if ($PSScriptRoot) { $AuditDir = Join-Path $PSScriptRoot 'audit' }
-            else { $AuditDir = Join-Path $env:TEMP 'audit' }
-        }
-
-        if (-not (Test-Path -LiteralPath $AuditDir)) { New-Item -ItemType Directory -Path $AuditDir -Force | Out-Null }
-
-        $date = (Get-Date).ToString('yyyyMMdd')
-        $safeLsp = if ($Lsp) { $Lsp } else { 'NA' }
-        $file = Join-Path $AuditDir ("Audit_{0}_{1}_{2}.csv" -f $date, $env:USERNAME, $safeLsp)
-
-        $row = [pscustomobject]@{
-            Timestamp  = (Get-Date).ToString('yyyy-MM-dd HH:mm:ss')
-            Username   = $env:USERNAME
-            LSP        = $Lsp
-            Assay      = $Assay
-            Batch      = $BatchNumber
-            TestCount  = $TestCount
-            Status     = if ($Status) { $Status } else { 'OK' }
-            ReportPath = $ReportPath
-        }
-        $exists = Test-Path -LiteralPath $file
-        $row | Export-Csv -Path $file -NoTypeInformation -Append:($exists) -Encoding UTF8
-    } catch {
-        Gui-Log "⚠️ Kunde inte skriva audit-fil: $($_.Exception.Message)" 'Warn'
-    }
-}
-
-function Write-StructuredLog {
-    param(
-        [string]$Message,
-        [ValidateSet('Info','Warn','Error')][string]$Severity = 'Info',
-        [string]$Category = 'General',
-        [hashtable]$Context
-    )
-    if (-not $global:LogPath) { return }
-    $jsonPath = "$($global:LogPath).jsonl"
-    $entry = [ordered]@{
-        Timestamp = (Get-Date).ToString('o')
-        Severity  = $Severity
-        Category  = $Category
-        Message   = $Message
-    }
-    if ($Context) {
-        foreach ($k in $Context.Keys) { $entry[$k] = $Context[$k] }
-    }
-    try {
-        Add-Content -Path $jsonPath -Value ($entry | ConvertTo-Json -Compress) -Encoding UTF8
-    } catch {
-        # tyst
-    }
-}
+﻿function Get-OutputBox {
+    try { return $script:outputBox } catch { return $null }
+}
+
+function Set-LogOutputControl {
+    param([System.Windows.Forms.TextBox]$Control)
+    $script:outputBox = $Control
+}
+
+function Gui-Log {
+    param(
+        [string]$Text,
+        [ValidateSet('Info', 'Warn', 'Error')]
+        [string]$Severity = 'Info',
+        [string]$Category = 'UI',
+        [hashtable]$Data,
+        [switch]$Immediate
+    )
+
+    # --- Förbered loggrad ---
+    $prefix = switch ($Severity) {
+        'Warn'  { '⚠️' }
+        'Error' { '❌' }
+        default { 'ℹ️' }
+    }
+
+    $timestamp = (Get-Date).ToString('HH:mm:ss')
+    $line = "[$timestamp] $prefix $Text"
+
+    # --- UI‑append scriptblock ---
+    $append = {
+        $outputBox.AppendText("$line`r`n")
+        $outputBox.SelectionStart = $outputBox.TextLength
+        $outputBox.ScrollToCaret()
+        $outputBox.Refresh()
+    }
+
+    # --- Hämta OutputBox ---
+    $outputBox = Get-OutputBox
+
+    if ($outputBox -and ($outputBox.IsDisposed -or -not $outputBox.IsHandleCreated)) {
+        $outputBox = $null
+    }
+
+    if ($outputBox) {
+        try {
+            if ($outputBox.InvokeRequired) {
+                $null = $outputBox.BeginInvoke(
+                    [System.Windows.Forms.MethodInvoker]$append
+                )
+            } else {
+                & $append
+            }
+
+            if ($Immediate) {
+                [System.Windows.Forms.Application]::DoEvents()
+            }
+        }
+        catch {
+            Write-Host $line
+        }
+    }
+    else {
+        Write-Host $line
+    }
+
+    # --- Patch: strukturerad logg (JSONL) ---
+    try {
+        Write-StructuredLog `
+            -Message  $Text `
+            -Severity $Severity `
+            -Category $Category `
+            -Data     $Data
+    } catch {}
+
+    # --- Klassisk filbaserad logg ---
+    if ($global:LogPath) {
+        try {
+            Add-Content -Path $global:LogPath -Value $line -Encoding UTF8
+        }
+        catch {
+            Write-Host "Loggning misslyckades: $($_.Exception.Message)"
+        }
+    }
+}
+
+function Add-AuditEntry {
+    param(
+        [string]$Lsp,
+        [string]$Assay,
+        [string]$BatchNumber,
+        [int]$TestCount,
+        [string]$Status,
+        [string]$ReportPath,
+        [string]$AuditDir
+
+    )
+    try {
+        if (-not $AuditDir) {
+            $netRootForAudit = ($env:IPT_NETWORK_ROOT + '').Trim()
+            if ($netRootForAudit -and (Test-Path -LiteralPath $netRootForAudit)) {
+                $AuditDir = Join-Path $netRootForAudit 'audit'
+            } elseif ($PSScriptRoot) {
+                $AuditDir = Join-Path $PSScriptRoot 'audit'
+            } else {
+                $AuditDir = Join-Path $env:TEMP 'audit'
+            }
+        }
+
+        if (-not (Test-Path -LiteralPath $AuditDir)) { New-Item -ItemType Directory -Path $AuditDir -Force | Out-Null }
+
+        $date = (Get-Date).ToString('yyyyMMdd')
+        $safeLsp = if ($Lsp) { $Lsp } else { 'NA' }
+        $file = Join-Path $AuditDir ("Audit_{0}_{1}_{2}.csv" -f $date, $env:USERNAME, $safeLsp)
+
+        $row = [pscustomobject]@{
+            Timestamp  = (Get-Date).ToString('yyyy-MM-dd HH:mm:ss')
+            Username   = $env:USERNAME
+            LSP        = $Lsp
+            Assay      = $Assay
+            Batch      = $BatchNumber
+            TestCount  = $TestCount
+            Status     = if ($Status) { $Status } else { 'OK' }
+            ReportPath = $ReportPath
+        }
+        $exists = Test-Path -LiteralPath $file
+        $row | Export-Csv -Path $file -NoTypeInformation -Append:($exists) -Encoding UTF8
+    } catch {
+        Gui-Log "⚠️ Kunde inte skriva audit-fil: $($_.Exception.Message)" 'Warn'
+    }
+}
+
+function Write-StructuredLog {
+    param(
+        [string]$Message,
+        [ValidateSet('Info','Warn','Error')][string]$Severity = 'Info',
+        [string]$Category = 'General',
+        [hashtable]$Context
+    )
+    if (-not $global:LogPath) { return }
+    $jsonPath = "$($global:LogPath).jsonl"
+    $entry = [ordered]@{
+        Timestamp = (Get-Date).ToString('o')
+        Severity  = $Severity
+        Category  = $Category
+        Message   = $Message
+    }
+    if ($Context) {
+        foreach ($k in $Context.Keys) { $entry[$k] = $Context[$k] }
+    }
+    try {
+        Add-Content -Path $jsonPath -Value ($entry | ConvertTo-Json -Compress) -Encoding UTF8
+    } catch {
+        # tyst
+    }
+}
diff -ruN /mnt/data/ps5compiled_orig/PS5Compiled/Version.txt /mnt/data/ps5compiled_minlog/PS5Compiled/Version.txt
--- /mnt/data/ps5compiled_orig/PS5Compiled/Version.txt	1970-01-01 00:00:00.000000000 +0000
+++ /mnt/data/ps5compiled_minlog/PS5Compiled/Version.txt	2026-01-28 16:26:55.419987563 +0000
@@ -0,0 +1 @@
+
