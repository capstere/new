<AssayRules>

  <!-- Rules version: update when the schema or logic changes -->

  <Version>2.0.0</Version>

  <ErrorCategories>

    <Minor>

      <Code>5018</Code>

      <Code>5006</Code>

      <Code>5007</Code>

      <Code>5011</Code>

      <Code>5017</Code>

      <Code>5019</Code>

      <Code>2037</Code>

      <Code>2029</Code>

      <Code>2008</Code>

      <Code>2009</Code>

      <Code>2125</Code>

      <Code>2096</Code>

      <Code>2097</Code>

      <Code>5001</Code>

      <Code>5002</Code>

      <Code>5003</Code>

      <Code>5004</Code>

      <Code>5005</Code>

      <Code>5015</Code>

      <Code>5016</Code>

    </Minor>

    <Valid>

      <Code>2005</Code>

      <Code>2025</Code>

      <Code>2014</Code>

      <Code>1001</Code>

      <Code>2035</Code>

      <Code>1018</Code>

      <Code>1002</Code>

      <Code>2026</Code>

      <Code>2126</Code>

      <Code>2022</Code>

      <Code>2032</Code>

    </Valid>

    <Unknown />

  </ErrorCategories>

  <StatusRules>

    <Rule Name="Done" RequireError="false" />

    <Rule Name="Aborted" RequireError="true">

      <AllowedTestResult>NO RESULT</AllowedTestResult>

      <AllowedTestResult>ERROR</AllowedTestResult>

    </Rule>

    <Rule Name="Incomplete" RequireError="true">

      <AllowedTestResult>NO RESULT</AllowedTestResult>

      <AllowedTestResult>ERROR</AllowedTestResult>

    </Rule>

  </StatusRules>

  <Assay Name="Xpert CT_NG">

    <!-- For CT_NG assays all samples are of type 'Specimen'. The sample ID third field must exactly be the string 'Specimen'. -->

    <SampleIDRegex>^([^_]+)_(\d{2}|00)_Specimen_(\d{2})([A-Z]*?)([X\+])(?:_D(?:[0-9A-Z]{1,2})(?:,[0-9A-Z]{1,2})*)?$</SampleIDRegex>

    <SuffixRule>Always=+</SuffixRule>

    <StartTimeRegex>^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\+|\-)\d{4}$</StartTimeRegex>

    <!-- Only 'Specimen' test type is valid for CT_NG assays -->

    <TestTypeToCode>

      <Map Type="Specimen" Code="Specimen" />

    </TestTypeToCode>

    <ValidResults>

      <Result Code="Specimen">

        <Value>CT NOT DETECTED;NG NOT DETECTED</Value>

        <Value>CT DETECTED;NG DETECTED</Value>

      </Result>

    </ValidResults>

    <ExtraColumns>

      <Column Name="Max Pressure (PSI)" Key="CE" />

      <Column Name="Error" Key="CG" />

    </ExtraColumns>

    <AllowedStatus>

      <Status>Done</Status>

      <Status>Aborted</Status>

      <Status>Incomplete</Status>

    </AllowedStatus>

    <!-- All specimen sample numbers may range between 01 and 99 -->

    <NumberRange>

      <Type Name="Specimen" Start="01" End="99" />

    </NumberRange>

    <!-- Do not check sample type mismatch because only one type exists -->

    <CheckSampleTypeMismatch>false</CheckSampleTypeMismatch>

  </Assay>

  <Assay Name="Xpress SARS-CoV-2_Flu_RSV plus">

    <SampleIDRegex>^([^_]+)_(\d{2}|00)_([012])_(\d{2})([A-Z]*?)([X\+])(?:_D(?:[0-9A-Z]{1,2})(?:,[0-9A-Z]{1,2})*)?$</SampleIDRegex>

    <SuffixRule>Odd=X,Even=+</SuffixRule>

    <StartTimeRegex>^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\+|\-)\d{4}$</StartTimeRegex>

    <TestTypeToCode>

      <Map Type="Negative Control 1" Code="0" />

      <Map Type="Positive Control 1" Code="1" />

    </TestTypeToCode>

    <ValidResults>

      <Result Code="1">

        <Value>SARS-CoV-2 POSITIVE;Flu A POSITIVE;Flu B POSITIVE;RSV POSITIVE</Value>

      </Result>

      <Result Code="0">

        <Value>SARS-CoV-2 NEGATIVE;Flu A NEGATIVE;Flu B NEGATIVE;RSV NEGATIVE</Value>

      </Result>

    </ValidResults>

    <ExtraColumns>

      <Column Name="Max Pressure (PSI)" Key="CY" />

      <Column Name="Error" Key="DA" />

    </ExtraColumns>

    <AllowedStatus>

      <Status>Done</Status>

      <Status>Aborted</Status>

      <Status>Incomplete</Status>

    </AllowedStatus>

    <NumberRange>

      <Type Name="Negative Control 1" Start="01" End="10" />

      <Type Name="Positive Control 1" Start="11" End="20" />

    </NumberRange>

    <CheckSampleTypeMismatch>true</CheckSampleTypeMismatch>

  </Assay>

  <Assay Name="Xpert MTB-RIF Ultra">

    <SampleIDRegex>^([^_]+)_(\d{2}|00)_([012])_(\d{2})([A-Z]*?)([X\+])(?:_D(?:[0-9A-Z]{1,2})(?:,[0-9A-Z]{1,2})*)?$</SampleIDRegex>

    <SuffixRule>Odd=X,Even=+</SuffixRule>

    <StartTimeRegex>^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\+|\-)\d{4}$</StartTimeRegex>

    <TestTypeToCode>

      <Map Type="Positive Control 2" Code="2" />

      <Map Type="Negative Control 1" Code="0" />

      <Map Type="Positive Control 1" Code="1" />

    </TestTypeToCode>

    <ValidResults>

      <Result Code="2">

        <Value>MTB DETECTED LOW;RIF Resistance NOT DETECTED</Value>

      </Result>

      <Result Code="1">

        <Value>MTB DETECTED LOW;RIF Resistance DETECTED</Value>

        <Value>MTB DETECTED VERY LOW;RIF Resistance DETECTED</Value>

      </Result>

      <Result Code="0">

        <Value>MTB NOT DETECTED</Value>

      </Result>

    </ValidResults>

    <ExtraColumns>

      <Column Name="Max Pressure (PSI)" Key="FY" />

      <Column Name="Error" Key="GA" />

    </ExtraColumns>

    <AllowedStatus>

      <Status>Done</Status>

      <Status>Aborted</Status>

      <Status>Incomplete</Status>

    </AllowedStatus>

    <NumberRange>

      <Type Name="Negative Control 1" Start="01" End="10" />

      <Type Name="Positive Control 1" Start="11" End="18" />

      <Type Name="Positive Control 2" Start="19" End="20" />

    </NumberRange>

    <CheckSampleTypeMismatch>true</CheckSampleTypeMismatch>

  </Assay>

  <Assay Name="Xpert_Carba-R">

    <SampleIDRegex>^([^_]+)_(\d{2}|00)_([012])_(\d{2})([A-Z]*?)([X\+])(?:_D(?:[0-9A-Z]{1,2})(?:,[0-9A-Z]{1,2})*)?$</SampleIDRegex>

    <SuffixRule>Odd=X,Even=+</SuffixRule>

    <StartTimeRegex>^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\+|\-)\d{4}$</StartTimeRegex>

    <TestTypeToCode>

      <Map Type="Negative Control 1" Code="0" />

      <Map Type="Positive Control 1" Code="1" />

      <Map Type="Positive Control 2" Code="2" />

    </TestTypeToCode>

    <ValidResults>

      <Result Code="2">

        <Value>IMP1 DETECTED;VIM DETECTED;NDM DETECTED;KPC DETECTED;OXA48 DETECTED</Value>

      </Result>

      <Result Code="1">

        <Value>IMP1 DETECTED;VIM DETECTED;NDM DETECTED;KPC DETECTED;OXA48 DETECTED</Value>

      </Result>

      <Result Code="0">

        <Value>IMP1 NOT DETECTED;VIM NOT DETECTED;NDM NOT DETECTED;KPC NOT DETECTED;OXA48 NOT DETECTED</Value>

      </Result>

    </ValidResults>

    <ExtraColumns>

      <Column Name="Max Pressure (PSI)" Key="CS" />

      <Column Name="Error" Key="CU" />

    </ExtraColumns>

    <AllowedStatus>

      <Status>Done</Status>

      <Status>Aborted</Status>

      <Status>Incomplete</Status>

    </AllowedStatus>

    <NumberRange>

      <Type Name="Negative Control 1" Start="01" End="10" />

      <Type Name="Positive Control 1" Start="11" End="18" />

      <Type Name="Positive Control 2" Start="19" End="20" />

    </NumberRange>

    <CheckSampleTypeMismatch>true</CheckSampleTypeMismatch>

  </Assay>

  <Assay Name="HPV v2">

    <SampleIDRegex>^([^_]+)_(\d{2}|00)_([01])_(\d{2})([A-Z]*?)([X\+])(?:_D(?:[0-9A-Z]{1,2})(?:,[0-9A-Z]{1,2})*)?$</SampleIDRegex>

    <SuffixRule>Always=X</SuffixRule>

    <StartTimeRegex>^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\+|\-)\d{4}$</StartTimeRegex>

    <TestTypeToCode>

      <Map Type="Negative Control 1" Code="0" />

      <Map Type="Positive Control 1" Code="1" />

    </TestTypeToCode>

    <ValidResults>

      <Result Code="1">

        <Value>HR HPV POS</Value>

      </Result>

      <Result Code="0">

        <Value>HR HPV NEG</Value>

        <Value>INVALID</Value>

      </Result>

    </ValidResults>

    <ExtraColumns>

      <Column Name="Max Pressure (PSI)" Key="CS" />

      <Column Name="Error" Key="CU" />

    </ExtraColumns>

    <AllowedStatus>

      <Status>Done</Status>

      <Status>Aborted</Status>

      <Status>Incomplete</Status>

    </AllowedStatus>

    <NumberRange>

      <Type Name="Negative Control 1" Start="01" End="10" />

      <Type Name="Positive Control 1" Start="11" End="20" />

    </NumberRange>

    <CheckSampleTypeMismatch>true</CheckSampleTypeMismatch>

  </Assay>

</AssayRules>
